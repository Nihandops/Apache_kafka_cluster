version: '3.8'
 
services:

  # Zookeeper 1

  zookeeper-1:

    image: confluentinc/cp-zookeeper:7.4.0

    hostname: zookeeper-1

    container_name: zookeeper-1

    ports:

      - "2181:2181"

      - "2888:2888"

      - "3888:3888"

    environment:

      ZOOKEEPER_CLIENT_PORT: 2181

      ZOOKEEPER_TICK_TIME: 2000

      ZOOKEEPER_SYNC_LIMIT: 2

      ZOOKEEPER_INIT_LIMIT: 5

      ZOOKEEPER_SERVERS: 0.0.0.0:2888:3888;192.168.10.*.*:2888:3888;192.168.10.*.*:2888:3888

      ZOOKEEPER_SERVER_ID: 1

      ZOOKEEPER_4LW_COMMANDS_WHITELIST: "*"

    volumes:

      - ./data/zookeeper-1/data:/var/lib/zookeeper/data

      - ./data/zookeeper-1/logs:/var/lib/zookeeper/log

    networks:

      - kafka-network

    extra_hosts:

      - "zookeeper-1:192.168.10.*.*"

      - "zookeeper-2:192.168.10.*.*"

      - "zookeeper-3:192.168.10.*.*"
 
  # Kafka 1

  kafka-1:

    image: confluentinc/cp-kafka:7.4.0

    hostname: kafka-1

    container_name: kafka-1

    depends_on:

      - zookeeper-1

    ports:

      - "9092:9092"

      - "29092:29092"

      - "9101:9101"

    environment:

      KAFKA_BROKER_ID: 1

      KAFKA_ZOOKEEPER_CONNECT: '192.168.10.*.*:2181,192.168.10.*.*:2181,192.168.10.*.*:2181'

      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT

      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.10.*.*:29092,PLAINTEXT_HOST://192.168.10.*.*:9092

      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT

      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:29092,PLAINTEXT_HOST://0.0.0.0:9092

      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3

      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 2

      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 3

      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0

      KAFKA_JMX_PORT: 9101

      KAFKA_JMX_HOSTNAME: localhost

      KAFKA_AUTO_CREATE_TOPICS_ENABLE: 'true'

      KAFKA_DELETE_TOPIC_ENABLE: 'true'

      KAFKA_LOG_RETENTION_HOURS: 168

      KAFKA_LOG_SEGMENT_BYTES: 1073741824

      KAFKA_LOG_RETENTION_CHECK_INTERVAL_MS: 300000

    volumes:

      - ./data/kafka-1:/var/lib/kafka/data

    networks:

      - kafka-network

    extra_hosts:

      - "kafka-1:192.168.10.*.*

      - "kafka-2:192.168.10.*.*"

      - "kafka-3:192.168.10.*.*"
 
 
 
